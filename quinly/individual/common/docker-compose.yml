# Services to host on all docker containers
networks:
  # Externally facing web services
  quinly-services:
    driver: macvlan
    name: quinly-services
    driver_opts:
      parent: ${SERV_NETWORK_PARENT}
    ipam:
      driver: default
      config:
        - subnet: 10.10.0.0/24
          gateway: 10.10.0.254

  # Internal quinly-based networking
  quinly-management:
    driver: macvlan
    name: quinly-management
    driver_opts:
      parent: ${MGMT_NETWORK_PARENT}
    ipam:
      driver: default
      config:
        - subnet: 10.10.99.0/24
          gateway: 10.10.99.254

services:
  # Log processing - https://github.com/jumanjihouse/docker-rsyslog
  # Also forces generation of all the networks
  rsyslog:
    container_name: rsyslog
    image: jumanjiman/rsyslog
    networks:
      quinly-services:
        ipv4_address: 10.10.0.${IP}

  # Watchtower - auto updater
  watchtower:
    container_name: watchtower
    image: containrrr/watchtower
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

  # Container management
  portainer:
    image: portainer/portainer-ce:latest
    container_name: portainer
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer-data:/data
    restart: always
    networks:
      quinly-services:
        ipv4_address: 10.10.0.71

volumes:
  portainer-data:
